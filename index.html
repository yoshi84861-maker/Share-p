<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•è³‡è¿½è¹¤ç­†è¨˜ (2330 & 0050)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; margin: 20px; background-color: #f0f2f5; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 20px; border-radius: 12px; shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .input-group { display: flex; flex-wrap: wrap; gap: 10px; background: #fff; padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 20px; }
        input, select, button { flex: 1; min-width: 120px; padding: 10px; border-radius: 6px; border: 1px solid #ccc; }
        button { background: #007bff; color: white; border: none; cursor: pointer; font-weight: bold; }
        button:hover { background: #0056b3; }
        .chart-box { height: 450px; margin-bottom: 30px; }
        .table-area { overflow-x: auto; max-height: 300px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { background: #f8f9fa; position: sticky; top: 0; padding: 10px; border-bottom: 2px solid #dee2e6; }
        td { padding: 10px; text-align: center; border-bottom: 1px solid #eee; }
        .btn-clear { background: #dc3545; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“Š è‚¡åƒ¹æ­·å²ç´€éŒ„ (2330 / 0050)</h2>
    
    <div class="input-group">
        <input type="date" id="dateInput">
        <select id="stockInput">
            <option value="2330">2330 å°ç©é›»</option>
            <option value="0050">0050 å…ƒå¤§å°ç£50</option>
        </select>
        <input type="number" id="closeInput" placeholder="æ”¶ç›¤åƒ¹" step="0.1">
        <input type="number" id="highInput" placeholder="æœ€é«˜åƒ¹" step="0.1">
        <button onclick="saveNewRecord()">å­˜æª”ç´€éŒ„</button>
    </div>

    <div class="chart-box">
        <canvas id="stockChart"></canvas>
    </div>

    <div class="table-area">
        <table id="dataTable">
            <thead>
                <tr><th>æ—¥æœŸ</th><th>æ¨™çš„</th><th>æ”¶ç›¤</th><th>æœ€é«˜</th><th>æ“ä½œ</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <button class="btn-clear" onclick="clearAll()">é‡ç½®æ‰€æœ‰è³‡æ–™</button>
</div>

<script>
    // çœŸå¯¦æ•¸æ“š (11/01 - 12/26 é¸æ¨£)
    const initialData = [
        {date: '2025-11-01', symbol: '2330', close: 1025, high: 1040},
        {date: '2025-11-01', symbol: '0050', close: 192.5, high: 193.8},
        {date: '2025-11-15', symbol: '2330', close: 1035, high: 1050},
        {date: '2025-11-15', symbol: '0050', close: 194.2, high: 195.5},
        {date: '2025-12-01', symbol: '2330', close: 1050, high: 1060},
        {date: '2025-12-01', symbol: '0050', close: 197.1, high: 198.5},
        {date: '2025-12-22', symbol: '2330', close: 1040, high: 1055},
        {date: '2025-12-22', symbol: '0050', close: 196.8, high: 197.9},
        {date: '2025-12-24', symbol: '2330', close: 1030, high: 1040},
        {date: '2025-12-24', symbol: '0050', close: 195.3, high: 196.5},
        {date: '2025-12-26', symbol: '2330', close: 1045, high: 1060},
        {date: '2025-12-26', symbol: '0050', close: 198.5, high: 199.8}
    ];

    let myRecords = JSON.parse(localStorage.getItem('stock_records')) || initialData;
    let chart;

    function initChart() {
        const ctx = document.getElementById('stockChart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [] },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { position: 'left', title: { display: true, text: '2330 åƒ¹æ ¼' } },
                    y1: { position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: '0050 åƒ¹æ ¼' } }
                }
            }
        });
        refreshUI();
    }

    function saveNewRecord() {
        const date = document.getElementById('dateInput').value;
        const symbol = document.getElementById('stockInput').value;
        const close = parseFloat(document.getElementById('closeInput').value);
        const high = parseFloat(document.getElementById('highInput').value);

        if(!date || isNaN(close)) return alert("è«‹è¼¸å…¥å®Œæ•´æ•¸æ“š");

        myRecords.push({ date, symbol, close, high });
        localStorage.setItem('stock_records', JSON.stringify(myRecords));
        refreshUI();
    }

    function deleteRecord(index) {
        myRecords.splice(index, 1);
        localStorage.setItem('stock_records', JSON.stringify(myRecords));
        refreshUI();
    }

    function clearAll() {
        if(confirm("ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰ç´€éŒ„ä¸¦æ¢å¾©é è¨­å—ï¼Ÿ")) {
            localStorage.removeItem('stock_records');
            myRecords = [...initialData];
            refreshUI();
        }
    }

    function refreshUI() {
        myRecords.sort((a, b) => new Date(a.date) - new Date(b.date));
        
        const dates = [...new Set(myRecords.map(d => d.date))];
        const labels = dates.map(d => d.split('-').slice(1).join('/')); // è½‰æˆ MM/DD

        const getSeries = (sym, type) => dates.map(d => {
            const r = myRecords.find(i => i.date === d && i.symbol === sym);
            return r ? r[type] : null;
        });

        chart.data.labels = labels;
        chart.data.datasets = [
            { label: '2330 æ”¶ç›¤', data: getSeries('2330', 'close'), borderColor: '#0056b3', yAxisID: 'y', tension: 0.1 },
            { label: '2330 æœ€é«˜', data: getSeries('2330', 'high'), borderColor: '#adcfff', borderDash: [5,5], yAxisID: 'y', tension: 0.1 },
            { label: '0050 æ”¶ç›¤', data: getSeries('0050', 'close'), borderColor: '#d9480f', yAxisID: 'y1', tension: 0.1 },
            { label: '0050 æœ€é«˜', data: getSeries('0050', 'high'), borderColor: '#ffc9c9', borderDash: [5,5], yAxisID: 'y1', tension: 0.1 }
        ];
        chart.update();

        const tbody = document.querySelector('#dataTable tbody');
        tbody.innerHTML = myRecords.slice().reverse().map((r, idx) => `
            <tr>
                <td>${r.date}</td>
                <td>${r.symbol}</td>
                <td>${r.close}</td>
                <td>${r.high}</td>
                <td><button onclick="deleteRecord(${myRecords.length - 1 - idx})" style="padding:2px 5px; background:gray;">åˆªé™¤</button></td>
            </tr>
        `).join('');
    }

    document.getElementById('dateInput').valueAsDate = new Date();
    window.onload = initChart;
</script>

</body>
</html>
