<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›™è‚¡è¿½è¹¤åŠ©æ‰‹ (2330 & 0050)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 20px; background-color: #f8f9fa; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        h2 { text-align: center; color: #1a1a1a; margin-bottom: 25px; }
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 25px; background: #f1f3f5; padding: 20px; border-radius: 10px; }
        input, select, button { padding: 12px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 14px; }
        button { background-color: #007bff; color: white; border: none; cursor: pointer; font-weight: 600; transition: 0.2s; }
        button:hover { background-color: #0056b3; }
        .chart-wrapper { position: relative; height: 50vh; min-height: 400px; width: 100%; margin: 20px 0; }
        .table-scroll { max-height: 300px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; }
        th { position: sticky; top: 0; background: #343a40; color: white; padding: 12px; z-index: 1; }
        td { padding: 10px; text-align: center; border-bottom: 1px solid #eee; }
        .legend-info { display: flex; justify-content: center; gap: 20px; margin-bottom: 10px; font-size: 13px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“ˆ 2330 & 0050 è‚¡åƒ¹ä¸¦è¡Œè¿½è¹¤</h2>

    <div class="input-grid">
        <input type="date" id="date" value="2025-12-29">
        <select id="stockSymbol">
            <option value="2330">2330 å°ç©é›»</option>
            <option value="0050">0050 å…ƒå¤§å°ç£50</option>
        </select>
        <input type="number" id="closePrice" placeholder="æ”¶ç›¤åƒ¹" step="0.1">
        <input type="number" id="highPrice" placeholder="æœ€é«˜åƒ¹" step="0.1">
        <button onclick="addData()">æ–°å¢ä¸¦æ›´æ–°</button>
    </div>

    <div class="legend-info">
        <span style="color:#2c3e50">â— 2330 æ”¶ç›¤/æœ€é«˜</span>
        <span style="color:#e67e22">â— 0050 æ”¶ç›¤/æœ€é«˜</span>
    </div>

    <div class="chart-wrapper">
        <canvas id="mainChart"></canvas>
    </div>

    <h3>æ­·å²æ•¸æ“šæ˜ç´°</h3>
    <div class="table-scroll">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>æ—¥æœŸ</th>
                    <th>ä»£è™Ÿ</th>
                    <th>æ”¶ç›¤åƒ¹</th>
                    <th>æœ€é«˜åƒ¹</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
    // ç”Ÿæˆ 11/01 - 12/26 çš„æ¨¡æ“¬æ•¸æ“š
    function generateInitialData() {
        const data = [];
        const start = new Date('2025-11-01');
        const end = new Date('2025-12-26');
        
        for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
            const day = d.getDay();
            if (day === 0 || day === 6) continue; // è·³éé€±æœ«

            const dateStr = d.toISOString().split('T')[0];
            
            // æ¨¡æ“¬ 2330 èµ°å‹¢ (ç´„ 1000~1080)
            const base2330 = 1000 + Math.random() * 80;
            data.push({ date: dateStr, symbol: '2330', close: base2330.toFixed(1), high: (base2330 + 5).toFixed(1) });

            // æ¨¡æ“¬ 0050 èµ°å‹¢ (ç´„ 190~205)
            const base0050 = 190 + Math.random() * 15;
            data.push({ date: dateStr, symbol: '0050', close: base0050.toFixed(1), high: (base0050 + 1).toFixed(1) });
        }
        return data;
    }

    let allData = generateInitialData();
    let chart;

    function initChart() {
        const ctx = document.getElementById('mainChart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [] },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                scales: {
                    y: { id: 'y', type: 'linear', position: 'left', title: { display: true, text: '2330 è‚¡åƒ¹' } },
                    y1: { id: 'y1', type: 'linear', position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: '0050 è‚¡åƒ¹' } }
                }
            }
        });
        updateAll();
    }

    function addData() {
        const date = document.getElementById('date').value;
        const symbol = document.getElementById('stockSymbol').value;
        const close = document.getElementById('closePrice').value;
        const high = document.getElementById('highPrice').value;

        if (!date || !close || !high) return alert("å¡«å¯«å®Œæ•´è³‡æ–™");

        allData.push({ date, symbol, close, high });
        allData.sort((a, b) => new Date(a.date) - new Date(b.date));
        updateAll();
    }

    function updateAll() {
        // å–å¾—æ‰€æœ‰æ—¥æœŸä¸¦è½‰ç‚º MM/DD
        const dates = [...new Set(allData.map(d => d.date))].sort();
        const labels = dates.map(d => {
            const parts = d.split('-');
            return `${parts[1]}/${parts[2]}`;
        });

        const ds2330_close = dates.map(d => allData.find(i => i.date === d && i.symbol === '2330')?.close || null);
        const ds2330_high = dates.map(d => allData.find(i => i.date === d && i.symbol === '2330')?.high || null);
        const ds0050_close = dates.map(d => allData.find(i => i.date === d && i.symbol === '0050')?.close || null);
        const ds0050_high = dates.map(d => allData.find(i => i.date === d && i.symbol === '0050')?.high || null);

        chart.data.labels = labels;
        chart.data.datasets = [
            { label: '2330 æ”¶ç›¤', data: ds2330_close, borderColor: '#2980b9', yAxisID: 'y', borderWidth: 2, pointRadius: 0 },
            { label: '2330 æœ€é«˜', data: ds2330_high, borderColor: '#3498db', borderDash: [5, 5], yAxisID: 'y', borderWidth: 1, pointRadius: 0 },
            { label: '0050 æ”¶ç›¤', data: ds0050_close, borderColor: '#d35400', yAxisID: 'y1', borderWidth: 2, pointRadius: 0 },
            { label: '0050 æœ€é«˜', data: ds0050_high, borderColor: '#e67e22', borderDash: [5, 5], yAxisID: 'y1', borderWidth: 1, pointRadius: 0 }
        ];
        chart.update();

        // è¡¨æ ¼æ›´æ–° (é¡¯ç¤ºæœ€è¿‘ 20 ç­†)
        const tbody = document.querySelector('#dataTable tbody');
        tbody.innerHTML = allData.slice().reverse().map(i => 
            `<tr><td>${i.date.slice(5)}</td><td>${i.symbol}</td><td>${i.close}</td><td>${i.high}</td></tr>`
        ).join('');
    }

    window.onload = initChart;
</script>
</body>
</html>
